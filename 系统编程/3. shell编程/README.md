# SHELL

shell:shell:既是一种命令语言，又是一种程序设计:computer:语言（即Shell脚本）。

- 作为一种基于命令的语言，Shell交互式地解释和执行用户输入的命令。
- 作为程序设计语言，Shell中可以定义各种变量，传递参数，并提供许多高级语言所具有的流程控制结构。

Shell虽然不是Linux系统内核的一部分，但它调用了系统内可得大部分功能来执行程序、创建文档并以并行的方式协调各个程序的运行。本章将学习Shell的相関概念以及Shell编程相关的知识。

[TOC]



## 一、Shell概述

Shell的愿意为"壳"（:shell: ），它包裹在内核之外，处于用户与内核之间。其主要功能为接收用户 :information_desk_person: 输入的命令，找到命令所在位置 :triangular_flag_on_post: ，并加以执行。

<img src="https://github.com/terminator-128/FairLand.github.io/raw/master/pictures/ShellKernalUser.png" style="zoom: 50%;" />

在计算机科学 :computer: 中，可以认为Shell是包裹在内核外的命令接口 ，又因为其最重要的功能是命令解释，所以也可以认为Shell是一个命令解释器。

---

### 1. Shell的分类

Shell的种类很多常见的有BSh、CSh、KSh、bash等。下标简单的说明了常见的Shell。

<img src="https://github.com/terminator-128/FairLand.github.io/raw/master/pictures/ShellKind.png" style="zoom:48%;" />

用户可通过`ls /bin/*sh` 查看系统中安装的shell。

---

### 2. Shell的功能

Shell最重要的功能是命令解释，Linux系统中的所有可执行文件都可以在Shell中执行。Linux系统中的可执行程序分为五类：

- Linux命令：用来使系统执行某种操作的指令，存放于/bin和/sbin目录下。
- 内置命令：存放于Shell内部的命令的解释程序，是一些常用的命令。可以使用`type 命令`的方式来查看某个命令是否为内置命令。
- 实用程序：存放于/usr/bin、/usr/sbin、/usr/local/bin等目录下的程序，如ls、which等。
- 用户程序：由用户编写的，经过编译后可执行的文件。
- Shell脚本：使用Shell语言编写的批处理文件。

---

### 3. Shell命令执行流程

Shell对命令的解释如图所示。

<img src="https://github.com/terminator-128/FairLand.github.io/raw/master/pictures/Process_ShellCommand.png" style="zoom:75%;" />

---



## 二、Shell应用技巧

<img src="..\..\pictures\Shell_pre.png" style="zoom:48%;" />

### 1. 输入输出重定向

Shell默认从终端接收用户命令，并将命令执行过程中产生的错误与命令的执行结果打印到终端，但并非任何时候用户都希望使用默认设置，这种情况下，可使用**<u>重定向</u>**，更改命令获取与信息输出的方向。

Linux的输入输出分为以下三类：

- **标准输入**（STDIN）
  - 标准输入文件的编号为0，默认设备是键盘
  - 命令执行时从标准内输入文件中读取需要的数据
- **标准输出**（STDOUT）
  - 标准输出文件的编号为1，默认设备是显示器
  - 命令执行时后其输出结果会被发送到标准输出文件
- **标准错误**（STDERR）
  - 标准错误文件的编号为2，默认设备是显示器
  - 命令执行时后其产生的错误信息会被发送到标准错误文件

<!--Linux通过对以上三种资源重定向。所谓重定向，即使用用户指定的文件而非默认资源（键盘、显示器）来获取或接收文件。-->

重定向可分为三种：输入重定向、输出重定向、错误重定向。

##### （1）输入重定向

输入重定向运算符<可以指定其右值为作左值的输入，具体格式如下：

```Linux
命令<文件名
```

以wall命令为例：

```shell
wall<file
```

##### （2）输出重定向

输出重定向运算符>可以将其右值作为左值的输出端。其格式如下：

```Linux
命令>文件名
```

以cat为例：

```shell
cat /etc/passwd>file
```

##### （3）错误重定向

错误重定向也可以使用重定向运算符>，重定向错误输出与输出重定向的方式略有不同，其格式如下：

```Linux
命令 2> 文件名
```

以gcc命令为例：

```shell
gcc -c hello.c -o hello 2>file
```

<!--输出与错误重定向都可以使用>>来以追加的方式将错误输出到指定的文件中-->

> 关于重定向的详细举例参见 [**Shell输入/输出重定向**](https://www.runoob.com/linux/linux-shell-io-redirections.html)

---

### 2. 管道

管道可以将多个简单的命令连接起来，使一个命令的输出作为另一个命令的输入，由此来实现更加复杂的功能。管道的符号为|，格式如下：

```Linux
命令1|命令2|···|命令n
```

以ls命令和grep的组合命令为例：

```shell
ls -l /etc | grep init
```

在以上示例中，**管道符** | 连接了ls命令和grep命令，其作用为：输出 etc目录下包含 init关键字的文件详细信息，若不使用管道则需使用如下两条命令才能完成这个任务：

```shell
ls -l /etc>tmp.txt
grep init<tmp.txt
```

---

### 3. 命令连接符

假如要完成一项比较复杂的操作，那么可能会用到多条Shell指令。当然用户可以每次输入一条指令，在此条指令执行完毕后在出入下一条指令，但这要求我们必须阻塞地等待命令的执行，那么是否可以将需要执行的命令一次性输入，让操作自动执行呢？答案是肯定的。

Shell中提供了一些用于连接命令的符号，包括&&以及||。使用这些符号，可以将多条Shell指令进行连接，是这些指令顺序或根据命令执行结果，有选择的执行。下面将对这些符号的功能分别进行介绍。

#### （1）；连接符

​	使用；连接符间隔的命令会按照先后次序执行。假如现在有一系列确定的操作需要执行，且这一系列操作的执行需要耗费一定时间，例如安装GDB包，在下载好安装包后还需要逐个执行以下命令。

```shell
tar -xzvf gdb-7.11.1.tar.gz
cd gdb-7.11.1
./configure
make
make install
gdb -v
```

且大多数命令开始执行后，都需要一定的时间，等待命令执行完毕。若此时使用；连接符连接这些命令：

```shell
tar -xzvf gdb-7.11.1.tar.gz;cd gdb-7.11.1;./confgure;make;make install;gdb -v
```

那么系统会自动执行这一系列命令

#### （2）&& 连接符

使用&&连接符连接的命令，其前后命令的执行遵循逻辑与关系，只有该连接符之前的命令执行成功，它后面的命令才被执行。

#### （3）||连接符

使用||连接符连接的命令，其前后命令的执行遵循逻辑或关系，只有该连接符之前的命令执行失败时，才会执行后面的命令。

---

### 文本提取器命令

Shell中常用awk提取文档或标准输出的文本信息，awk实际上是一个强大的文本分析工具，该工具类似于常用命令中的grep，都能从指定文本中提取指定信息。不同的是，该命令可将文本按指定分隔符分割，并从分割结果中提取指定项。该命令的格式如下：

```shell
awk [-F 分隔符1] '{print $1 {"分隔符2"} $2···$n-1{分隔符n}$n}'
```

[^]: 其中分隔符1指定源文件中的分隔符，缺省情况下，以空格作为默认分隔符；分隔符2指定打印内容中的分隔符，缺省情况下，打印的内容不进行分隔。

<!--awk一行为单位分隔，若第n个位置内容不存在则不打印出，但分隔符还会打印出-->

